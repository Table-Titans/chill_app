{% set session_info = session %}
{% set page_title = session_info.title or "Study Session Details" %}
{% set start_label = session_info.start_display or session_info.time_display %}
{% set end_label = session_info.end_display %}
{% set location_label = location_details.label if location_details else (session_info.location or "Location TBD") %}
{% set map_query = location_details.map_query if location_details else session_info.location %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{{ page_title }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    {% include "partials/navbar.html" %}

    <div class="form-container session-details">
        <a href="{{ url_for('home') }}" class="back-btn">‚Üê Back to dashboard</a>

        <div class="session-header">
            <h1 class="session-title">
                {{ session_info.title or "Study Session Overview" }}
                {% if session_info.chill_level %}
                    <span>{{ session_info.chill_level }}</span>
                {% endif %}
            </h1>
            <p class="session-subtitle">{{ session_info.description }}</p>
        </div>

        <div class="session-summary-grid">
            <div class="summary-card">
                <span class="summary-label">Start</span>
                <span class="summary-value">{{ start_label or "TBD" }}</span>
                {% if end_label %}
                    <span class="summary-label">End</span>
                    <span class="summary-value">{{ end_label }}</span>
                {% endif %}
            </div>
            <div class="summary-card">
                <span class="summary-label">Location</span>
                <span class="summary-value">{{ location_label }}</span>
            </div>
            <div class="summary-card">
                <span class="summary-label">Organizer</span>
                <span class="summary-value">{{ session_info.organizer }}</span>
            </div>
            <div class="summary-card">
                <span class="summary-label">Capacity</span>
                <span class="summary-value">
                    {% if session_info.attendees is not none and session_info.max_attendees %}
                        {{ session_info.attendees }} / {{ session_info.max_attendees }}
                    {% elif session_info.attendees is not none %}
                        {{ session_info.attendees }}
                    {% else %}
                        Not listed
                    {% endif %}
                </span>
            </div>
        </div>

        <div class="session-sections">
            <div class="session-card">
                <h2 class="session-section-title">Overview</h2>
                <p>{{ session_info.description }}</p>
                {% if session_info.notes %}
                    <div class="notes-highlight">
                        <p><strong>Notes:</strong> {{ session_info.notes }}</p>
                    </div>
                {% endif %}
            </div>

            <div class="session-card">
                <h2 class="session-section-title">Course Information</h2>
                <div class="course-grid">
                    <div class="course-row">
                        <span class="course-label">Course Name</span>
                        <span class="course-value">
                            {% if course_details and course_details.title %}
                                {{ course_details.title }}
                            {% elif session_info.course_name %}
                                {{ session_info.course_name }}
                            {% else %}
                                Not listed
                            {% endif %}
                        </span>
                    </div>
                    <div class="course-row">
                        <span class="course-label">Term</span>
                        <span class="course-value">
                            {% if course_details and course_details.term %}
                                {{ course_details.term }}
                            {% else %}
                                N/A
                            {% endif %}
                        </span>
                    </div>
                    <div class="course-row">
                        <span class="course-label">Section</span>
                        <span class="course-value">
                            {% if course_details and course_details.section %}
                                {{ course_details.section }}
                            {% elif session_info.section %}
                                {{ session_info.section }}
                            {% else %}
                                N/A
                            {% endif %}
                        </span>
                    </div>
                    <div class="course-row">
                        <span class="course-label">Year</span>
                        <span class="course-value">
                            {% if course_details and course_details.year %}
                                {{ course_details.year }}
                            {% elif session_info.year %}
                                {{ session_info.year }}
                            {% else %}
                                N/A
                            {% endif %}
                        </span>
                    </div>
                    <div class="course-row">
                        <span class="course-label">Professor</span>
                        <span class="course-value">
                            {% if course_details and course_details.professor %}
                                {{ course_details.professor }}
                            {% elif session_info.professor_name %}
                                {{ session_info.professor_name }}
                            {% else %}
                                N/A
                            {% endif %}
                        </span>
                    </div>
                </div>
            </div>

            <div class="session-card map-card">
                <h2 class="session-section-title">Where to Meet</h2>
                {% if map_query %}
                    <iframe
                        class="map-frame"
                        loading="lazy"
                        allowfullscreen
                        src="https://www.google.com/maps?q={{ map_query | urlencode }}&amp;output=embed">
                    </iframe>
                {% else %}
                    <div class="map-placeholder">Map preview will appear here once the location is finalized.</div>
                {% endif %}
            </div>

            <div class="session-card attendees-card">
                <h2 class="session-section-title">Attendees</h2>
                {% if attendee_list %}
                    <ul class="attendee-list">
                        {% for attendee in attendee_list %}
                            <li>{{ attendee }}</li>
                        {% endfor %}
                    </ul>
                {% elif attendee_count %}
                    <p>{{ attendee_count }} attendee{{ '' if attendee_count == 1 else 's' }} currently registered.</p>
                {% else %}
                    <p>No attendee details have been shared yet.</p>
                {% endif %}
            </div>
        </div>
    </div>
</body>
</html>
